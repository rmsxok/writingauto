import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Slider } from "@/components/ui/slider";
import { Select, SelectTrigger, SelectContent, SelectItem, SelectValue } from "@/components/ui/select";

export default function NaverWriter() {
  const [step, setStep] = useState(1);
  const [apiKey, setApiKey] = useState("");
  const [keyword, setKeyword] = useState("");
  const [reference, setReference] = useState("");
  const [tone, setTone] = useState(3); // 1=감성, 5=이성
  const [format, setFormat] = useState("question");
  const [titles, setTitles] = useState([]);
  const [selectedTitle, setSelectedTitle] = useState("");
  const [body, setBody] = useState("");

  // --- 제목 생성 (샘플 로직: 실제는 OpenAI API 연동 필요)
  const generateTitles = () => {
    const baseTitles = [
      `(${keyword})란 무엇일까? 숨겨진 이야기`,
      `${keyword}의 3가지 핵심 포인트`,
      `${keyword}, 사람들이 놓치고 있는 작은 비밀`,
      `${keyword} 완벽 정리: 지금 꼭 알아야 할 이유`,
      `데이터로 보는 ${keyword}의 현재와 미래`
    ];
    setTitles(baseTitles);
    setStep(3);
  };

  // --- 본문 생성 (샘플 로직)
  const generateBody = () => {
    let rawText = `
서론: ${keyword}에 대한 흥미로운 시작...
본론: ${reference || "참고 내용 없음"}을 기반으로 ${keyword}의 심화 설명...
결론: ${keyword}를 통해 얻을 수 있는 인사이트 요약...
    `;
    // 문법 검수 시뮬레이션 + 문단 끝에 여백
    const refined = rawText
      .split("\n")
      .map(line => line.trim())
      .filter(line => line.length > 0)
      .map(line => line + "\n\n")
      .join("");
    setBody(refined);
  };

  return (
    <div className="min-h-screen bg-gray-900 text-gray-100 p-6 flex flex-col items-center">
      <Card className="w-full max-w-2xl bg-gray-800 shadow-lg rounded-2xl">
        <CardContent className="p-6 space-y-6">
          {/* STEP NAV */}
          <div className="flex justify-between text-sm text-gray-400">
            <span className={step === 1 ? "text-white font-bold" : ""}>1. API Key</span>
            <span className={step === 2 ? "text-white font-bold" : ""}>2. 키워드 & 제목</span>
            <span className={step === 3 ? "text-white font-bold" : ""}>3. 본문 작성</span>
          </div>

          {/* STEP 1 */}
          {step === 1 && (
            <div className="space-y-4">
              <h2 className="text-xl font-semibold">OpenAI API Key 입력</h2>
              <Input
                type="password"
                placeholder="API Key (선택)"
                value={apiKey}
                onChange={(e) => setApiKey(e.target.value)}
              />
              <Button className="w-full" onClick={() => setStep(2)}>다음 단계</Button>
            </div>
          )}

          {/* STEP 2 */}
          {step === 2 && (
            <div className="space-y-4">
              <h2 className="text-xl font-semibold">키워드 입력 및 제목 후보 생성</h2>
              <Input
                placeholder="예: 개인정보 보호법"
                value={keyword}
                onChange={(e) => setKeyword(e.target.value)}
              />
              <Textarea
                placeholder="참고할 내용을 입력하세요 (선택)"
                value={reference}
                onChange={(e) => setReference(e.target.value)}
              />

              {/* 형식 선택 */}
              <div>
                <label className="block mb-2">제목 형식 선택</label>
                <Select value={format} onValueChange={setFormat}>
                  <SelectTrigger className="w-full bg-gray-700">
                    <SelectValue placeholder="형식 선택" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="question">질문형</SelectItem>
                    <SelectItem value="command">명령형</SelectItem>
                    <SelectItem value="list">리스트형</SelectItem>
                    <SelectItem value="compare">비교형</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              {/* 톤 슬라이더 */}
              <div>
                <label className="block mb-2">감성 ↔ 이성 톤</label>
                <Slider min={1} max={5} step={1} value={[tone]} onValueChange={(val) => setTone(val[0])} />
                <p className="text-sm text-gray-400 mt-1">현재 값: {tone}</p>
              </div>

              <Button className="w-full" onClick={generateTitles}>제목 후보 생성</Button>
            </div>
          )}
          {/* STEP 3 */}
          {step === 3 && (
            <div className="space-y-6">
              <h2 className="text-xl font-semibold">제목 선택 → 본문 작성 & 검수</h2>

              {/* 2단계에서 만들어진 제목 후보 표시 */}
              {titles.length > 0 ? (
                <div className="space-y-3">
                  <p className="text-sm text-gray-400">제목 후보 중 하나를 선택하세요.</p>
                  <div className="space-y-2">
                    {titles.map((t, idx) => (
                      <label
                        key={idx}
                        className={`flex items-start gap-3 p-3 rounded-xl cursor-pointer border ${
                          selectedTitle === t ? "border-blue-400 bg-gray-700/50" : "border-gray-700 bg-gray-800"
                        }`}
                      >
                        <input
                          type="radio"
                          className="mt-1"
                          name="titlePick"
                          checked={selectedTitle === t}
                          onChange={() => setSelectedTitle(t)}
                        />
                        <span className="leading-relaxed">{t}</span>
                      </label>
                    ))}
                  </div>
                </div>
              ) : (
                <div className="text-sm text-red-300">
                  제목 후보가 없습니다. 2단계에서 “제목 후보 생성”을 먼저 실행하세요.
                </div>
              )}

              {/* 본문 생성/검수 컨트롤 */}
              <div className="space-y-3">
                <div className="flex items-center justify-between gap-3">
                  <Button
                    disabled={!selectedTitle}
                    onClick={generateBody}
                    className="w-1/2"
                  >
                    본문 생성
                  </Button>

                  {/* 간단 검수(시뮬레이션) + 자동 여백 옵션 */}
                  <div className="flex-1 flex flex-col gap-2">
                    <label className="flex items-center gap-2 text-sm text-gray-300">
                      <input
                        type="checkbox"
                        defaultChecked
                        onChange={() => {}}
                        disabled
                      />
                      문장 끝 자동 여백(엔터 2회) — 생성 시 적용됨
                    </label>
                    <Button
                      variant="outline"
                      className="w-full bg-gray-700 text-gray-100"
                      onClick={() => {
                        // 간단한 문장 정리(시뮬레이션). 실제 사용 시 OpenAI 교정 호출 가능
                        const refined = (body || "")
                          .replace(/[ \t]+\n/g, "\n")   // 줄 끝 공백 정리
                          .replace(/\n{3,}/g, "\n\n"); // 과도한 개행 정리
                        setBody(refined);
                      }}
                      disabled={!body}
                    >
                      빠른 검수(로컬 정리)
                    </Button>
                  </div>
                </div>

                {/* 결과 본문 */}
                <div className="space-y-2">
                  <label className="block text-sm">결과 본문</label>
                  <Textarea
                    rows={14}
                    placeholder="여기에 본문이 생성됩니다."
                    value={body}
                    onChange={(e) => setBody(e.target.value)}
                    className="bg-gray-800"
                  />
                </div>
              </div>

              {/* 네비게이션 */}
              <div className="flex items-center justify-between">
                <Button variant="outline" className="bg-gray-700 text-gray-100" onClick={() => setStep(2)}>
                  이전(2단계)
                </Button>
                <div className="text-sm text-gray-400">작성 완료 시 블로그에 붙여넣어 게시하세요.</div>
              </div>
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}
